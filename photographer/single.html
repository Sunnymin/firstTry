<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
         <meta name='viewport' content='width = device-width,initial-scale=1.0,maxinum-scale=1.0,minimum-scale=1.0, user-scalable=no'>
        <title></title>
        <link rel="stylesheet" href="css/base.css">
        <link rel="stylesheet" href="css/single.css">
   </head>
   <body>
           <div class="layout">
           <!-- 封面背景图  begin-->
                <div class="cover"></div>
           <!-- 封面背景图  end-->
            <!-- 摄影师及服务介绍 begin -->
                <div class="introduce">
                     <div class="introduce_name">
                     </div>
                    <!-- 类别介绍  begin -->
                     <div class="introduce_sort clearfix">
                           <div class="xiezhen">
                                <span></span>
                                <span class="tabName">随心拍</span>
                           </div>
                           <div class="price">
                                <span></span>
                                <span id="price">99元</span>
                           </div>
                           <div class="level">
                                <span></span>
                                <span>钻级美摄</span> 
                           </div>
                     </div>
                    <!-- 类别介绍  end -->
                    <!-- 服务介绍 begin  -->
                     <div class="introduce_server">
                        <div class='server_title'>服务详情</div>
                        <div class='content'>
                           <div>
                                <span class='time'></span>
                                <span>1小时拍摄</span>
                             </div>
                             <div>
                                <span class='count'></span>
                                <span>40张照片</span>
                             </div>
                             <div>
                                <span class='truing'></span>
                                <span>10张精修</span>
                             </div>
                             <div>
                                <span class='huzhuang'></span>
                                <span>不提供化妆</span>
                             </div>
                             <div>
                                <span class='clothes'></span>
                                <span>不提供服装</span>
                             </div>
                             <div>
                                <span class='chengpin'></span>
                                <span>不提供成品</span>
                             </div> 
                         </div>
                     </div>
                </div>
                  <!-- 服务介绍 end  -->
              <!-- 摄影师及服务介绍 end -->
              <!-- 单套作品介绍及展示 begin   -->
                <div class="photo">
                      <p>MYPIC</p>
                      
                      <div class="photo_address">
                         
                      </div>
                      <div class="photo_img">
                          
                      </div>
                </div>
            <!-- 单套作品介绍及展示 begin   -->
           <!-- 立即下载  begin-->
                <div class="download_">
                </div>
            <!-- 立即下载  end-->
           </div>
      <script type="text/template" id="template1">
               <img src=<%-"http://"+model[0].imgUrl%> 
                       style="width:100%">
       </script>  
       <script type="text/template" id="template2">
              <div class="portrait">
                 <a href=<%-"homepage.html?userId="+userId%>>
                   <img src=<%-"http://"+infor.serviceUserHeadUrl%> 
                       style="width:4.125rem;height:4.125rem">
                 </a>
              </div>
              <p id="n1"><%-infor.serviceUserName%></p>
       </script>
       <script type="text/template" id="template3">
               <div class="xiezhen">
                  <span></span>
                  <span><%-infor.tabName%></span>
               </div>
               <div class="price">
                  <span></span>
                  <span><%-infor.price%>元</span>
               </div>
               <div class="level">
                  <span>
                    <%if(infor.level=="铜级"){%>
                    <img src="./image/copper.png" style="width:100%;height:100%">
                    <%}else if(infor.level=="银级"){%>
                    <img src="./image/silver.png" style="width:100%;height:100%">
                    <%}else if(infor.level=="金级"){%>
                    <img src="./image/gold.png" style="width:100%;height:100%">
                    <%}%>
                  </span>
                  <span><%-infor.level%>美摄</span>
               </div>

       </script>  
        <script type="text/template" id="template4">
                 <%_.each(model,function(item,i){%>
               <!-- <img src=<%-"http://"+model[i].imgUrl%> 
                       style="width:100%"> -->
                <img class="test-lazyload" src="image/blank.png" data-original=<%-"http://"+model[i].imgUrl%> 
                       style="width:100%">
               <%});%>
        </script> 
         <script type="text/template" id="template5">
                 <span></span>
                 <span><%-data.data.placeName%></span><br>
                 <span><%-data.data.provinceName%> · <%-data.data.cityName%></span>
        </script>
        <script type="text/template" id="template6"> 
        <div>
                                <span class='time'></span>
                                <span><%-data.data.shot_duration%>小时拍摄</span>
                             </div>
                             <div>
                                <span class='count'></span>
                                <span><%-data.data.shot_num%>张照片</span>
                             </div>
                             <div>
                                <span class='truing'></span>
                                <span><%-data.data.refinement_num%>张精修</span>
                             </div>
                             <div>
                                <span class='huzhuang'></span>
                                <span><%if(data.data.isOfferMakeup===0){%>
                                化妆自备
                                <%}else{%>
                                提供化妆
                                 <%}%> 
                                </span>
                             </div>
                             <div>
                                <span class='clothes'></span>
                                <span><%if(data.data.isOfferClothing===0){%>
                                服装自备
                                <%}else{%>
                                提供服装
                                 <%}%> 
                                 </span>
                             </div>
                             <div>
                                <span class='chengpin'></span>
                                <span><%if(data.data.isOfferClothing===0){%>
                                不提供成品
                                <%}else{%>
                                提供成品
                                 <%}%> 
                                 </span>
                             </div>
      </script>
       <script type="text/template" id="template7" >
              <div class="download">
              <div class="logo"></div>
                      <div class="load">
                       <a href="http://a.app.qq.com/o/simple.jsp?pkgname=com.meipian.www"><p>美片APP下载</p></a>
              </div>
              </div>
           </script>
     <script type="text/javascript" src="./js/zepto.min.js"></script>
     <script type="text/javascript" src="js/lazyload.js"></script>
     <script type="text/javascript" src="./js/underscore-min.js"></script>
     <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
     <script type="text/javascript" src="./js/common.js"></script>
     <script type="text/javascript">
                $(document).ready(function(){
                 var url = location.href;
                 var desc;

                    /*--获取网页传递的参数--*/
                   function request(paras)
                 { 
                     // var url = location.href; 
                     var paraString = url.substring(url.indexOf("?")+1,url.length).split("&"); 
                     var paraObj = {} 
                     for (i=0; j=paraString[i]; i++){ 
                     paraObj[j.substring(0,j.indexOf("=")).toLowerCase()] = j.substring(j.indexOf("=")+1,j.length); 
                 } 
                     var returnValue = paraObj[paras.toLowerCase()]; 
                     if(typeof(returnValue)=="undefined"){ 
                     return ""; 
                 }else{ 
                     return returnValue; 
                 } 
               }
               var photographerWorkId = request('photographerWorkId');
               var serivceUserId = request('serivceUserId');
               
               var nickName = request("nickName");
               nickName = decodeURI(nickName);
             
               
              /*--获取网页传递的参数 end--*/
              // 图片预加载  begin
             function preLoadImg(url) { 
                 var img = new Image(); 
                     img.src = url;
                     img.onload=function(){
                      console.log(111)
                     }
                   }; 
          
               // 图片预加载  end
              //判断是否是微信浏览器  begin
               function isWeiXin(){ 
                  var ua = window.navigator.userAgent.toLowerCase(); 
                  if(ua.match(/MicroMessenger/i) == 'micromessenger'){ 
                   return true; 
                  }else{ 
                  return false; 
               } 
             };
                $(".load p").click(function(){
                  if(isWeiXin()){
                  $(".cover1")[0].style.display="block";
                };
                })
            
             $(".cover1 span").click(function(){
              $(".cover1")[0].style.display="none";
             })

               //判断是否是微信浏览器  end
                
                    $.ajax({
                               type: 'POST',
                               url: '/meipian/photographer/queryPhotographerWorkDetilsById',
                               data: { photographerWorkId:photographerWorkId,serivceUserId:serivceUserId},
                               dataType: 'json',
                               success: function(data){
                               
                               var photographerWorkImgs = data.data.photographerWorkImgs;
                                    desc = photographerWorkImgs[0].imgUrl;

                                   var arr=photographerWorkImgs;
                                   preLoadImg("http://"+desc);
                                   var infor = data.data;
                                    var level = infor.level;
                                    
            $("title").html("【"+infor.serviceUserName+"】-"+infor.tabName+"("+infor.provinceName+"·"+infor.cityName+","+infor.placeName);

                                  var template1 = _.template($('#template1').html())
                                 $(".cover").html(template1({model:photographerWorkImgs}));
                                 
                                 arr.shift();
                                 var template2 = _.template($('#template2').html())
                                 $(".introduce_name").html(template2({infor:infor,userId:serivceUserId}));
                                      
                                  var template3 = _.template($('#template3').html())
                                 $(".introduce_sort").html(template3({infor:infor}));

                                 var template4 = _.template($('#template4').html())
                                 $(".photo_img").html(template4({model:arr}));
                   // 图片懒加载
$('.test-lazyload').picLazyLoad({
    threshold: 100,
    placeholder: './image/blank.png'
});
 // 图片懒加载
                                  var template5 = _.template($('#template5').html())
                                 $(".photo_address").html(template5({data:data}));

                                 var template6 = _.template($('#template6').html())
                                 $(".content").html(template6({data:data}));

                                  var template7 = _.template($('#template7').html())
                                 $(".download_").html(template7({}));
                                 // 第二次请求 begin
                              $.ajax({
              type: 'POST',
              url: '/meipian/wxconfig/getConfig',
              data:{url:url},
             dataType: 'json',
             success: function(data){
               
                var datas = data.data;
                
wx.config({
    debug: false, 
    appId: datas.appId, 
    timestamp: datas.timestamp, 
    nonceStr: datas.nonceStr, 
    signature: datas.signature,
    jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage','onMenuShareQQ'] 
});

wx.ready(function(){
    // 获取“分享到朋友圈”按钮点击状态及自定义分享内容接口
    wx.onMenuShareTimeline({
        title:$("title").html(), // 分享标题
        desc: $("title").html(),
        link:location.href,
        imgUrl:"http://"+desc+"?imageView2/1/w/640"// 分享图标
    });
    // 获取“分享给朋友”按钮点击状态及自定义分享内容接口
    wx.onMenuShareAppMessage({
        title: '拍照片，上美片', // 分享标题
        desc: $("title").html(), // 分享描述
        link:location.href,
        imgUrl:"http://"+desc+"?imageView2/1/w/640", // 分享图标
        type: 'link', // 分享类型,music、video或link，不填默认为link
    });
    // “分享到QQ”
     wx.onMenuShareQQ({
       title: '拍照片，上美片', // 分享标题
        desc: $("title").html(), // 分享描述
        link:location.href,
        imgUrl: "http://"+desc+"?imageView2/2/w/640", // 分享图标
        type: 'link', // 分享类型,music、video或link，不填默认为link
      
    });
});
wx.error(function(res){
   console.log(111)
    
});


                 },
             error: function(){
                 
             }
      });
                            // 第二次请求end 
                           
                             },
                            error: function(xhr, type){
                                 alert('error!')
                              }
                      })
                   
               });
           </script>   
    </body>
</html>
